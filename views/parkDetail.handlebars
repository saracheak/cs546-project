<section class="park-details-page">
    <div class="park-details-card">
        <h1>{{title}}</h1>
        <link rel="stylesheet" href="/css/styles.css">

        {{#if park.address}}
            <p class="park-address">
                <strong>Address:</strong> 
                {{park.address.street_1}},
                {{#if park.address.street_2}} 
                    {{park.address.street_2}},
                {{/if}}
                {{park.address.city}}, {{park.address.state}} {{park.address.zip_code}}
            </p>
        {{/if}}

        <p class="park-type">
            <strong>Type:</strong> {{park.park_type}}
        </p>

        <hr />

        <h2>Ratings</h2>

        <div class="park-ratings-grid">
            <p><strong>Cleanliness: </strong> {{park.average_cleanliness}}</p>
            <p><strong>Dog Friendliness: </strong> {{park.average_dog_friendliness}}</p>
            <p><strong>Busyness: </strong> {{park.average_busyness}}</p>
            <p><strong>Water Availability: </strong> {{park.average_water_availability}}</p>
            <p><strong>Wastebag Availability: </strong> {{park.average_wastebag_availability}}</p>
            <p><strong>Trash Availability: </strong> {{park.average_trash_availability}}</p>
            <p><strong>Surface: </strong> {{park.average_surface}}</p>
            <p><strong>Amenities: </strong> {{park.average_amenities}}</p>
        </div>

        <hr />

        <section class="park-comments-section">
            <h2>Comments</h2>

            <div class="comment-list" id="comment-list" data-park-id="{{park._id}}">
                {{#each comments}}
                    <div class="comment-item" data-comment-id="{{this._id}}">
                        <p class="comment-text">{{this.comment}}</p>

                        <p class="comment-details">
                            <span class="comment-author">
                                {{#if this.authorName}}
                                    {{this.authorName}}
                                {{else}}
                                    Anonymous Pup
                                {{/if}}
                            </span>
                            <span class="comment-date">
                                {{#if this.timestamp}}
                                    {{this.timestamp}}
                                {{else}}
                                    (no timestamp)
                                {{/if}}
                            </span>
                        </p>

                        <div class="comment-interaction">
                            {{#if ../isLoggedIn}}
                                <button type="button" class="comment-like-button" data-comment-id="{{this._id}}">
                                    ðŸ¦´ 
                                    <span class="like-count">{{this.likes}}</span>
                                </button>
                            {{/if}}

                            {{#if this.canDelete}}
                                <button type="button" class="comment-delete-button" data-comment-id="{{this._id}}">
                                    Delete
                                </button>
                            {{/if}} 
                        </div>
                    </div>
                {{/each}}
            </div>
        </section>

        <hr />

        <section class="park-add-comment-section">
            <h2>Leave a comment</h2>

            {{#if isLoggedIn}}
            <form
                id="comment-form"
                method="POST"
                action="/parks/{{park._id}}/comments"
                novalidate
                class="comment-form"
            >
                <label for="comment">
                    Your comment (max 500 characters):
                </label>
                <textarea
                    id="comment"
                    name="comment"
                    rows="4"
                    maxlength="500"
                    required
                ></textarea>

                <p id="comment-error" class="form-error"></p>

                <button type="submit">Post Comment</button>
            </form>
            {{else}}
                <p>You must be logged in to leave a comment.</p>
            {{/if}}
        </section>
        <br>
        {{#if (parksIncludes ../user.favoriteParks park._id)}}
            <button class="favorite-btn" data-id="{{park._id}}" data-action="remove">Remove this park from my Favorite Parks</button>
        {{else}}
            <button class="favorite-btn" data-id="{{park._id}}" data-action="add">Add this park to my Favorite Parks</button>
        {{/if}}

        <div id="favorite-park-msg" class="favorite-park-msg">
            <p>{{message}}</p>
        </div>

        {{#if (parksIncludes ../user.parksVisited park._id)}}
            <button class="parks-visited-btn" data-id="{{park._id}}" data-action="remove">Remove this park from my Parks Visited</button>
        {{else}}
            <button class="parks-visited-btn" data-id="{{park._id}}" data-action="add">Add this park to my Parks Visited</button>
        {{/if}}

        <div id="parks-visited-msg" class="parks-visited-msg">
            <p>{{message}}</p>
        </div>

        <p class="back-link">
            <a href="/parks">Back to all parks</a>
        </p>

    </div>
</section>

<script src="/js/comments.js"></script>

<script src="/js/parks.js"></script>
